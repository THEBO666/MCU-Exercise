C51 COMPILER V8.06   0                                                                     02/15/2012 20:54:05 PAGE 1   


C51 COMPILER V8.06, COMPILATION OF MODULE 0
OBJECT MODULE PLACED IN 0.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 0.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************HJ-3GÊµÑé¿ª·¢°åÀý³Ì************************
   2          *  Æ½Ì¨£ºHJ-3G V6.0 + Keil U3 + STC89C52
   3          *  Ãû³Æ£º¼ÇÂ¼°´¼üs1°´ÏÂµÄ´ÎÊý£¬ÇÒÔÚµôµçÊÇÈÔ¿É±£´æ£¬ÖØÐÂ¿ª»úºóÊýÂë¹Ü
   4                                  ÈÔ¿ÉÏÔÊ¾ÉÏ´ÎÎ´µôµçÊ±£¬s1°´ÏÂµÄ´ÎÊý£¬s2¼üÓÃÀ´¶Ô´ÎÊý½øÐÐÇåÁã¡£
   5          *  ¹«Ë¾£º»Û¾»µç×Ó¿Æ¼¼ÓÐÏÞ¹«Ë¾
   6          *  ÌÔ±¦£ºhttp://shop37031453.taobao.com       
   7          *  ÍøÕ¾£ºwww.hlmcu.com
   8          *  ±àÐ´£º
   9          *  ÈÕÆÚ£º2008-8-08
  10          *   QQ : 121350852  398115088
  11          *  ¾§Õñ:11.0592MHZ
  12          *  ËµÃ÷£ºÃâ·Ñ¿ªÔ´£¬²»Ìá¹©Ô´´úÂë·ÖÎö£¬ÓÐÎÊÌâÖ±½Óµ½»Û¾»ÂÛÌ³½»Á÷
  13          *  ÂÛÌ³£ºhttp://hjdz.5d6d.com
  14          ******************************************************************/
  15          #include<reg51.h>
  16          #include <intrins.h>
  17          #define uint unsigned int
  18          #define uchar unsigned char
  19          uint num;        //¶¨Òå¼ÆÊýÖµ£¬Ã¿¹ý1Ãë£¬sec¼Ó1
  20          sbit sda=P2^0;                          //IO¿Ú¶¨Òå
  21          sbit scl=P2^1;
  22          sbit dula=P2^6;
  23          sbit wela=P2^7;
  24          sbit s1=P3^4;//¼ÆÊý°´¼ü
  25          sbit s2=P3^5;//ÇåÁã°´¼ü
  26          unsigned char j,k;
  27          char a,b;
  28          
  29          void delay(unsigned char i)             //ÑÓÊ±³ÌÐò
  30          {
  31   1        for(j=i;j>0;j--)
  32   1          for(k=125;k>0;k--);
  33   1      }
  34          
  35          uchar code table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,                         //ÊýÂë¹Ü±àÂë
  36                                  0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  37          
  38          void nop()
  39          {
  40   1              _nop_();
  41   1              _nop_();
  42   1      }
  43          void display(uchar a,uchar b)                   //ÏÔÊ¾³ÌÐò
  44          {
  45   1         dula=0;
  46   1         P0=table[a];         //ÏÔÊ¾°ÙÎ»
  47   1         dula=1;
  48   1         dula=0;
  49   1      
  50   1         wela=0;
  51   1         P0=0x7e;
  52   1         wela=1;
  53   1         wela=0;
  54   1         delay(5);
  55   1      
C51 COMPILER V8.06   0                                                                     02/15/2012 20:54:05 PAGE 2   

  56   1         dula=0;
  57   1         P0=table[b];         //ÏÔÊ¾Ê®Î»
  58   1         dula=1;
  59   1         dula=0;
  60   1      
  61   1         wela=0;
  62   1         P0=0x7d;
  63   1         wela=1;
  64   1         wela=0;
  65   1         delay(5);
  66   1      
  67   1         /*dula=0;
  68   1         P0=table[c];         //ÏÔÊ¾¸öÎ»
  69   1         dula=1;
  70   1         dula=0;
  71   1      
  72   1         wela=0;
  73   1         P0=0x7b;
  74   1         wela=1;
  75   1         wela=0;
  76   1         delay(5);
  77   1               */
  78   1      }
  79          
  80          /////////24C02¶ÁÐ´Çý¶¯³ÌÐò////////////////////
  81          void delay1(unsigned int m)
  82          {       unsigned int n;
  83   1              for(n=0;n<m;n++);
  84   1      }
  85          
  86          void init()  //24c02³õÊ¼»¯×Ó³ÌÐò
  87          {
  88   1              scl=1;
  89   1              nop();
  90   1              sda=1;
  91   1              nop();
  92   1      }
  93          
  94          void start()        //Æô¶¯I2C×ÜÏß
  95          {
  96   1              sda=1;
  97   1              nop();
  98   1              scl=1;
  99   1              nop();
 100   1              sda=0;
 101   1              nop();
 102   1              scl=0;
 103   1              nop();
 104   1      }
 105          
 106          void stop()         //Í£Ö¹I2C×ÜÏß
 107          {
 108   1              sda=0;
 109   1              nop();
 110   1              scl=1;
 111   1              nop();
 112   1              sda=1;
 113   1              nop();
 114   1      }
 115          
 116          void writebyte(unsigned char j)  //Ð´Ò»¸ö×Ö½Ú
 117          {
C51 COMPILER V8.06   0                                                                     02/15/2012 20:54:05 PAGE 3   

 118   1              unsigned char i,temp;
 119   1              temp=j;
 120   1              for (i=0;i<8;i++)
 121   1         {
 122   2                 temp=temp<<1;
 123   2                 scl=0;
 124   2                 nop();
 125   2                 sda=CY;              //temp×óÒÆÊ±£¬ÒÆ³öµÄÖµ·ÅÈëÁËCYÖÐ
 126   2                 nop();
 127   2                 scl=1;               //´ýsdaÏßÉÏµÄÊý¾ÝÎÈ¶¨ºó£¬½«sclÀ­¸ß
 128   2                 nop();
 129   2         }
 130   1         scl=0;
 131   1         nop();
 132   1         sda=1;
 133   1         nop();
 134   1      }
 135          
 136          unsigned char readbyte()   //¶ÁÒ»¸ö×Ö½Ú
 137          {
 138   1         unsigned char i,j,k=0;
 139   1         scl=0; nop(); sda=1;
 140   1         for (i=0;i<8;i++)
 141   1         {  
 142   2                      nop(); scl=1; nop();
 143   2              if(sda==1) 
 144   2                      j=1;
 145   2              else
 146   2                      j=0;
 147   2              k=(k<<1)|j;
 148   2                      scl=0;
 149   2              }
 150   1              nop();
 151   1              return(k);
 152   1      }
 153          
 154          void clock()         //I2C×ÜÏßÊ±ÖÓ
 155          {
 156   1         unsigned char i=0;
 157   1         scl=1;
 158   1         nop();
 159   1         while((sda==1)&&(i<255))
 160   1                i++;
 161   1         scl=0;
 162   1         nop();
 163   1      }
 164          
 165          ////////´Ó24c02µÄµØÖ·addressÖÐ¶ÁÈ¡Ò»¸ö×Ö½ÚÊý¾Ý/////
 166          unsigned char read24c02(unsigned char address)
 167          {
 168   1         unsigned char i;
 169   1         start();
 170   1         writebyte(0xa0);
 171   1         clock();
 172   1         writebyte(address);
 173   1         clock();
 174   1         start();
 175   1         writebyte(0xa1);
 176   1         clock();
 177   1         i=readbyte();
 178   1         stop();
 179   1         delay1(100);
C51 COMPILER V8.06   0                                                                     02/15/2012 20:54:05 PAGE 4   

 180   1         return(i);
 181   1      }
 182          
 183          //////Ïò24c02µÄaddressµØÖ·ÖÐÐ´ÈëÒ»×Ö½ÚÊý¾Ýinfo/////
 184          void write24c02(unsigned char address,unsigned char info)
 185          {
 186   1         start();
 187   1         writebyte(0xa0);
 188   1         clock();
 189   1         writebyte(address);
 190   1         clock();
 191   1         writebyte(info);
 192   1         clock();
 193   1         stop();
 194   1         delay1(5000); //Õâ¸öÑÓÊ±Ò»¶¨Òª×ã¹»³¤£¬·ñÔò»á³ö´í¡£ÒòÎª24c02ÔÚ´ÓsdaÉÏÈ¡µÃÊý¾Ýºó£¬»¹ÐèÒªÒ»¶¨Ê±¼äµÄÉÕÂ¼¹ý³
             -Ì¡£
 195   1      }
 196          
 197          void main()
 198          {
 199   1              init();        //³õÊ¼»¯24C02
 200   1              num=read24c02(0);
 201   1              while(1)
 202   1              {
 203   2                      if(!s1)
 204   2                      {
 205   3                              while(!s1);
 206   3                              num++;
 207   3                              write24c02(0,num);
 208   3                      }
 209   2                      if(!s2)
 210   2                      {
 211   3                              num=0;
 212   3                              write24c02(0,num);
 213   3                      }
 214   2                      a=num/10;
 215   2                      b=num%10;
 216   2                      display(a,b);
 217   2              }
 218   1              
 219   1      }
 220          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    383    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
