C51 COMPILER V8.06   12864A_3                                                              06/24/2012 20:28:08 PAGE 1   


C51 COMPILER V8.06, COMPILATION OF MODULE 12864A_3
OBJECT MODULE PLACED IN 12864A-3.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 12864A-3.c DEBUG OBJECTEXTEND

line level    source

   1          /**********************HJ-3G实验开发板例程************************
   2          *  平台：HJ-3G V6.0 + Keil U3 + STC89C52
   3          *  名称：
   4          *  公司：慧净电子科技有限公司
   5          *  淘宝：http://shop37031453.taobao.com       
   6          *  网站：www.hlmcu.com
   7          *  编写：
   8          *  日期：2008-8-08
   9          *   QQ : 121350852  398115088
  10          *  晶振:11.0592MHZ
  11          *  说明：免费开源，不提供源代码分析，有问题直接到慧净论坛交流
  12          *  论坛：http://hjdz.5d6d.com
  13          ******************************************************************/
  14          /*******************************************************************/
  15          /*                                                                 */
  16          /* 单片机开发系统演示程序 - 128*64LCD显示显示  */
  17          /*                                                                 */
  18          //;*  LCD型号：TS12864A-3（带汉字库）或兼容型号    控制器ST7920      */
  19          //;*  MCU:AT89S52 ,晶体频率：11.0592MHz                              */
  20          /*                                                                 */
  21          /*******************************************************************/
  22          
  23          #include <reg51.h>
  24          #include <intrins.h>
  25                  
  26          #define uchar unsigned char
  27          #define uint  unsigned int
  28          /*12864端口定义*/
  29          #define LCD_data  P0             //数据口
  30          sbit LCD_RS  =  P1^0;            //寄存器选择输入 
  31          sbit LCD_RW  =  P1^1;            //液晶读/写控制
  32          sbit LCD_EN  =  P2^5;            //液晶使能控制
  33          sbit LCD_PSB =  P1^2;            //串/并方式控制
  34          sbit wela    =  P2^6;
  35          sbit dula    =  P2^7;
  36          
  37          uchar code dis1[] = {"慧净电子"};
  38          uchar code dis2[] = {"www.hjmcu.com"};
  39          uchar code dis3[] = {"HL-1  学习板 "};
  40          uchar code dis4[] = {"是您最好的选择！ "};
  41          
  42          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};
  43          uchar IRDIS[2];
  44          uchar IRCOM[4];
  45          void delay0(uchar x);  //x*0.14MS
  46          void beep();
  47          void  dataconv();
  48          void lcd_pos(uchar X,uchar Y);  //确定显示位置
  49          /*******************************************************************/
  50          /*                                                                 */
  51          /*  延时函数                                                       */
  52          /*                                                                 */
  53          /*******************************************************************/
  54          void delay(int ms)
  55          {
C51 COMPILER V8.06   12864A_3                                                              06/24/2012 20:28:08 PAGE 2   

  56   1          while(ms--)
  57   1              {
  58   2            uchar i;
  59   2                for(i=0;i<250;i++)  
  60   2                 {
  61   3                  _nop_();                       
  62   3                      _nop_();
  63   3                      _nop_();
  64   3                      _nop_();
  65   3                 }
  66   2              }
  67   1      }               
  68          /*******************************************************************/
  69          /*                                                                 */
  70          /*检查LCD忙状态                                                    */
  71          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
  72          /*                                                                 */
  73          /*******************************************************************/
  74          bit lcd_busy()
  75           {                          
  76   1          bit result;
  77   1          LCD_RS = 0;
  78   1          LCD_RW = 1;
  79   1          LCD_EN = 1;
  80   1          delayNOP();
  81   1          result = (bit)(P0&0x80);
  82   1          LCD_EN = 0;
  83   1          return(result); 
  84   1       }
  85          /*******************************************************************/
  86          /*                                                                 */
  87          /*写指令数据到LCD                                                  */
  88          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
  89          /*                                                                 */
  90          /*******************************************************************/
  91          void lcd_wcmd(uchar cmd)
  92          {                          
  93   1         while(lcd_busy());
  94   1          LCD_RS = 0;
  95   1          LCD_RW = 0;
  96   1          LCD_EN = 0;
  97   1          _nop_();
  98   1          _nop_(); 
  99   1          P0 = cmd;
 100   1          delayNOP();
 101   1          LCD_EN = 1;
 102   1          delayNOP();
 103   1          LCD_EN = 0;  
 104   1      }
 105          /*******************************************************************/
 106          /*                                                                 */
 107          /*写显示数据到LCD                                                  */
 108          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
 109          /*                                                                 */
 110          /*******************************************************************/
 111          void lcd_wdat(uchar dat)
 112          {                          
 113   1         while(lcd_busy());
 114   1          LCD_RS = 1;
 115   1          LCD_RW = 0;
 116   1          LCD_EN = 0;
 117   1          P0 = dat;
C51 COMPILER V8.06   12864A_3                                                              06/24/2012 20:28:08 PAGE 3   

 118   1          delayNOP();
 119   1          LCD_EN = 1;
 120   1          delayNOP();
 121   1          LCD_EN = 0; 
 122   1      }
 123          /*******************************************************************/
 124          /*                                                                 */
 125          /*  LCD初始化设定                                                  */
 126          /*                                                                 */
 127          /*******************************************************************/
 128          void lcd_init()
 129          { 
 130   1      
 131   1          LCD_PSB = 1;         //并口方式
 132   1          
 133   1          lcd_wcmd(0x34);      //扩充指令操作
 134   1          delay(5);
 135   1          lcd_wcmd(0x30);      //基本指令操作
 136   1          delay(5);
 137   1          lcd_wcmd(0x0C);      //显示开，关光标
 138   1          delay(5);
 139   1          lcd_wcmd(0x01);      //清除LCD的显示内容
 140   1          delay(5);
 141   1      }
 142          /*********************************************************/
 143          /*                                                                                                               */
 144          /* 主程序                                                                                */
 145          /*                                                       */
 146          /*********************************************************/
 147            main()
 148           {
 149   1          uchar i;
 150   1          delay(10);                 //延时
 151   1          wela=0;
 152   1              dula=0; 
 153   1          lcd_init();                //初始化LCD             
 154   1        
 155   1          lcd_pos(0,0);             //设置显示位置为第一行的第1个字符
 156   1           i = 0;
 157   1          while(dis1[i] != '\0')
 158   1           {                         //显示字符
 159   2             lcd_wdat(dis1[i]);
 160   2             i++;
 161   2           }
 162   1          lcd_pos(1,0);             //设置显示位置为第二行的第1个字符
 163   1           i = 0;
 164   1          while(dis2[i] != '\0')
 165   1           {
 166   2             lcd_wdat(dis2[i]);      //显示字符
 167   2             i++;
 168   2           }
 169   1               lcd_pos(2,0);             //设置显示位置为第三行的第1个字符
 170   1           i = 0;
 171   1          while(dis3[i] != '\0')
 172   1           {
 173   2             lcd_wdat(dis3[i]);      //显示字符
 174   2             i++;
 175   2           }
 176   1               lcd_pos(3,0);             //设置显示位置为第四行的第1个字符
 177   1           i = 0;
 178   1          while(dis4[i] != '\0')
 179   1           {
C51 COMPILER V8.06   12864A_3                                                              06/24/2012 20:28:08 PAGE 4   

 180   2             lcd_wdat(dis4[i]);      //显示字符
 181   2             i++;
 182   2           }
 183   1           while(1);
 184   1      }
 185          
 186          
 187          
 188          /*********************************************************/
 189          /*                                                                                                               */
 190          /* 延时x*0.14ms子程序                                                                    */
 191          /*                                                       */
 192          /*********************************************************/
 193          
 194          void delay0(uchar x)    //x*0.14MS
 195          {
 196   1        uchar i;
 197   1        while(x--)
 198   1       {
 199   2        for (i = 0; i<13; i++) {}
 200   2       }
 201   1      }
 202          /*********************************************************/
 203          /*                                                       */
 204          /* 设定显示位置                                          */
 205          /*                                                       */
 206          /*********************************************************/
 207          void lcd_pos(uchar X,uchar Y)
 208          {                          
 209   1         uchar  pos;
 210   1         if (X==0)
 211   1           {X=0x80;}
 212   1         else if (X==1)
 213   1           {X=0x90;}
 214   1         else if (X==2)
 215   1           {X=0x88;}
 216   1         else if (X==3)
 217   1           {X=0x98;}
 218   1         pos = X+Y ;  
 219   1         lcd_wcmd(pos);     //显示地址
 220   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    302    ----
   CONSTANT SIZE    =     55    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
